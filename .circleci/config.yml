version: 2.1
jobs:
  test-analyze-format-job:
    docker:
      - image: dart:stable-sdk
    steps:
      - checkout
      - restore_cache:
          keys:
            - pub-cache-v1--{{ .Branch }}-{{ checksum "pubspec.yaml" }}
      - run: "dart pub get"
      - save_cache:
          key: pub-cache-v1--{{ .Branch }}-{{ checksum "pubspec.yaml" }}
          paths:
            - ~/.pub-cache
      - run: "./dart_rucksack.sh -v test"
      - run: "./dart_rucksack.sh -v analyze"
      - run: "./dart_rucksack.sh -v format"
      - run: "git diff-index --name-status HEAD"

workflows:
  main:
    jobs:
      - test-analyze-format-job
